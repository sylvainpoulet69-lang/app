<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tennis Vision — MVP hors-ligne</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>Tennis Vision — MVP</h1>
    <p>Entraînement cognitif & vision du jeu (fonctionne sans internet, en local)</p>
  </header>

  <main>
    <section class="panel">
      <h2>1) Charger un <u>fichier vidéo</u> depuis votre ordinateur</h2>
      <input type="file" id="videoFile" accept="video/*"/>
      <div class="video-wrap">
        <video id="player" playsinline></video>
        <canvas id="overlay"></canvas>
        <div id="overlayPrompt" class="qa-box fade"></div>
        <div id="optionsWrap" class="qa-box fade"></div>
        <div id="sessionEnd" class="hidden">
          <div class="summary">
            <h3>Fin de l'exercice</h3>
            <div id="summaryStats"></div>
            <div class="row">
              <button id="restartSession">Rejouer</button>
              <button id="closeSummary">Fermer</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt8">
        <button id="playPause">Lecture / Pause</button>
        <button id="frameBack">&larr;1 frame</button>
        <button id="frameForward">1 frame&rarr;</button>
        <button id="btnRestartExercise">Recommencer</button>
        <label for="playbackRate">Vitesse :</label>
        <select id="playbackRate">
          <option value="0.25">0.25×</option>
          <option value="0.5">0.5×</option>
          <option value="0.75">0.75×</option>
          <option value="1" selected>1×</option>
          <option value="1.25">1.25×</option>
          <option value="1.5">1.5×</option>
          <option value="1.75">1.75×</option>
          <option value="2">2×</option>
        </select>
        <span class="hint">Astuce : réglez le timing d'un arrêt en mettant la vidéo en pause exactement au bon moment. Utilisez la vitesse et les boutons « ←1 frame » / « 1 frame→ » pour un contrôle précis.</span>
      </div>
    </section>

    <section class="panel">
      <h2>2) Mode Éditeur</h2>
      <div class="row">
        <button id="btnAddPredictStop">Ajouter arrêt « Prédire l'atterrissage » <span class="shortcut-badge">P</span></button>
        <button id="btnAddDecisionStop">Ajouter arrêt « Décision coup suivant » <span class="shortcut-badge">D</span></button>
        <button id="btnDefineAnswer">Définir la réponse (cliquer sur la vidéo) <span class="shortcut-badge">R</span></button>
        <button id="exportScenario">Exporter le scénario (JSON)</button>
      </div>
      <div class="shortcut-help">Espace = Lecture/Pause · P = Prédire l’atterrissage · D = Décision coup suivant · R = Définir la réponse</div>
      <div class="row">
        <label class="inline">
          <input type="checkbox" id="zoneMode"/>
          Mode zones
        </label>
        <label>Colonnes :
          <input type="number" id="gridCols" value="2" min="1"/>
        </label>
        <label>Lignes :
          <input type="number" id="gridRows" value="2" min="1"/>
        </label>
        <label>Options (séparées par des virgules) pour « Décision » :
          <input type="text" id="decisionOptions" placeholder="ex : CD croisé, Revers long de ligne, Amorti, Lob"/>
        </label>
        <label>Réponse correcte :
          <input type="text" id="decisionCorrect" placeholder="Doit correspondre exactement à une option"/>
        </label>
      </div>
      <div>
        <h3>Arrêts du scénario</h3>
        <table id="stopsTable">
          <thead>
            <tr><th>#</th><th>Temps (s)</th><th>Type</th><th>Détails</th><th>Actions</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="panel">
      <h2>3) Mode Lecture / Entraînement</h2>
      <div class="row">
        <input type="file" id="scenarioFile" accept="application/json"/>
        <button id="startSession">Démarrer la séance</button>
        <button id="exportCSV">Exporter résultats (CSV)</button>
        <button id="exportJSON">Exporter résultats (JSON)</button>
      </div>
      <div id="sessionStats"></div>
    </section>

    <section class="panel">
      <h2>Graphiques</h2>
      <canvas id="rtHistogram" width="400" height="200"></canvas>
      <h3>Progression des temps de réaction</h3>
      <canvas id="progressChart"></canvas>
      <h3>Comparaison multi-séances</h3>
      <canvas id="sessionComparisonChart"></canvas>
      <h3>Scores par arrêt</h3>
      <ul id="perStopScores"></ul>
    </section>
  </main>

  <div id="editStopModal" class="hidden">
    <div class="summary">
      <h3>Éditer l'arrêt</h3>
      <label>Temps (s)
        <input type="number" step="0.01" id="editStopTime"/>
      </label>
      <label>Type
        <select id="editStopType">
          <option value="predict-landing">Prédire atterrissage</option>
          <option value="next-shot">Décision coup suivant</option>
        </select>
      </label>
      <div id="editPredictFields">
        <label class="inline"><input type="checkbox" id="editZoneMode"/> Mode zones</label>
        <label>Cols <input type="number" id="editGridCols" min="1"/></label>
        <label>Rows <input type="number" id="editGridRows" min="1"/></label>
        <label>X splits <input type="text" id="editGridX" placeholder="ex:0.5"/></label>
        <label>Y splits <input type="text" id="editGridY" placeholder="ex:0.5"/></label>
        <label>Réponse X <input type="number" step="0.01" id="editAnswerX"/></label>
        <label>Réponse Y <input type="number" step="0.01" id="editAnswerY"/></label>
      </div>
      <div id="editDecisionFields" class="hidden">
        <label>Options <input type="text" id="editOptions"/></label>
        <label>Correct <input type="text" id="editCorrect"/></label>
      </div>
      <div class="row">
        <button id="saveEditStop">Enregistrer</button>
        <button id="cancelEditStop">Annuler</button>
      </div>
    </div>
  </div>

  <footer>
    <small>MVP local — Aucun envoi de données. Vos scénarios et résultats restent sur votre machine.</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.3.0/dist/chartjs-plugin-zoom.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
